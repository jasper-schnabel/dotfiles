#!/bin/sh

if [ "$1" = "-h" ] || [ "$1" = "--help" ] || [ -n "$1" ]; then
  cat <<EOF
\$ install-neovim [FLAGS]
Install everything required for my neovim setup.
See: https://github.com/jasper-schnabel/neovim

Flags:
  -h: this menu, --help shows this too
EOF
  exit 1
fi

command -v npm >/dev/null || { echo "error: npm is not installed, exiting..."; exit 1; }
command -v git >/dev/null || { echo "error: git is not installed, exiting..."; exit 1; }
command -v ninja >/dev/null || { echo "error: ninja is not installed, exiting..."; exit 1; }
command -v nvim >/dev/null || { echo "error: nvim is not installed, exiting..."; exit 1; }

LUA_SERVER_PATH="$HOME/.local/share/nvim/lua-language-server"

install_lua_server() {
  git clone https://github.com/sumneko/lua-language-server "$LUA_SERVER_PATH"
  cd "$LUA_SERVER_PATH" && git submodule update --init --recursive
  cd "$LUA_SERVER_PATH/3rd/luamake" && compile/install.sh
  cd "$LUA_SERVER_PATH" && ./3rd/luamake/luamake rebuild
}

git clone https://github.com/jasper-schnabel/neovim.git "$HOME/.config/nvim" || echo "Neovim config already pulled."
sudo npm i -g typescript typescript-language-server vscode-langservers-extracted emmet-ls bash-language-server
install_lua_server
git clone --depth=1 https://github.com/savq/paq-nvim.git "$HOME/.local/share/nvim/site/pack/paqs/start/paq-nvim"

tput setaf 3; echo "\nPlease run 'nvim +PaqSync' and then reopen neovim."
